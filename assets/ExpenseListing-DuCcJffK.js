import{j as e,q as I,s as B,r as p,G as h,o as u,t as C,_ as S,u as F,F as j,B as v}from"./index-HH_UOIZx.js";import{I as P,C as q,R}from"./CommonTitle-CeQYZZhX.js";import{M as T,D as b,a as A}from"./DateIcon-COKakmTY.js";import{F as z}from"./FilterButton-D-icS8k3.js";import{D as G}from"./DataTable-DmZ13xqo.js";import{A as L}from"./ActionButton-DmpfxdBo.js";import{R as y,A as M}from"./AddButton-EMGjYyJp.js";import{z as i,u as H,a as N}from"./index-DOWDAM7u.js";import{u as _}from"./useGetAccountList-CvKiyq5C.js";import{u as K}from"./useMutation-Dn-P9RO6.js";import{a as D}from"./axiosInstance-f51KjAOb.js";import{S as E}from"./Stack-CJLiOtGk.js";import{S as d}from"./Select-DmDJsrLN.js";import{N as k}from"./NumberInput-C3nc0w_S.js";import{T as Q}from"./Textarea-D2hRWm4X.js";import{B as w,L as V}from"./Button-BxVRjdO9.js";import{u as $}from"./useQuery-CfinWix-.js";import"./createReactComponent-BvNoKUJd.js";import"./IconTrash-dlyoLBAc.js";import"./InputBase-BzmGfW4v.js";const W=()=>{const s=t=>{alert(t.no)},r=t=>{alert(t.no)};return[{name:"No",selector:t=>t.no,width:"70px"},{name:"Date",selector:t=>t.date.split("T")[0],width:"150px"},{name:"Bank/Cash Account",selector:t=>t.relatedAccounting.subHeader,width:"200px"},{name:"Balance",selector:t=>t.finalAmount,width:"150px"},{name:"Initial Amount",selector:t=>t.initialAmount,width:"160px"},{name:"Final Amount",selector:t=>t.finalAmount,width:"160px"},{name:"Remark",selector:t=>t.remark||"-",width:"178px"},{name:"Actions",cell:t=>e.jsx(L,{row:t,onDelete:()=>r(t),onEdit:()=>s(t)}),width:"200px"}]},J=i.object({relatedAccounting:i.string().min(1,"account is required"),date:i.date(),remark:i.string().min(1,"remark is required"),initialAmount:i.number().min(1,"initial amount is required"),initialCurrency:i.string().min(1,"initial currency is required"),finalAmount:i.number().min(1,"final amount is required"),finalCurrency:i.string().min(1,"final currency is required")}),O=async s=>{await D.post("/expense",s)},U=()=>{const s=I();return K({mutationFn:O,onSuccess:()=>{s.invalidateQueries(["expense"])}})},X=()=>{const[s,{open:r,close:o}]=B(!1),[t,c]=p.useState("cash"),{mutate:x,isPending:m}=U(),{data:l}=_(),n=H({mode:"controlled",initialValues:{relatedAccounting:"",initialAmount:0,initialCurrency:"1",finalAmount:0,finalCurrency:"1",date:new Date,remark:""},validate:N(J)}),g=a=>{const f={...a,data:C(a.date)};console.log(f),x(f,{onSuccess:()=>{S.success("Expense created successfully"),n.reset(),o()},onError:()=>{S.error("Something went wrong")}})};return p.useEffect(()=>{n.setFieldValue("finalAmount",n.values.initialAmount)},[n.values.initialAmount,n]),e.jsxs(e.Fragment,{children:[e.jsx(T,{size:550,centered:!0,opened:s,onClose:o,title:"Expense Create",styles:{title:{fontSize:"20px",fontWeight:600}},children:e.jsxs(E,{children:[e.jsx(y.Group,{value:t,onChange:a=>c(a),children:e.jsxs(h,{mt:"xs",justify:"center",children:[e.jsx(y,{color:u,value:"cash",label:"Cash"}),e.jsx(y,{color:u,value:"bank",label:"Bank"})]})}),e.jsx("form",{onSubmit:n.onSubmit(g),children:e.jsxs(E,{children:[t==="cash"?e.jsx(d,{placeholder:"Enter cash account",label:"Cash Accounts",allowDeselect:!1,...n.getInputProps("relatedAccounting"),data:l==null?void 0:l.filter(a=>a.name==="Cash in Hand").map(a=>({label:a.subHeader,value:a._id}))}):e.jsx(d,{label:"Bank Accounts",placeholder:"Enter bank account",...n.getInputProps("relatedAccounting"),allowDeselect:!1,data:l==null?void 0:l.filter(a=>a.relatedHeader.name==="Cash at Bank").map(a=>({label:a.name,value:a._id}))}),e.jsxs(h,{grow:!0,children:[e.jsx(k,{w:"50%",label:"Initial Amount",...n.getInputProps("initialAmount")}),e.jsx(d,{data:[{label:"Myanmar Kyat",value:"1"}],w:"50%",label:"Initial Currency",...n.getInputProps("initialCurrency")})]}),e.jsxs(h,{grow:!0,children:[e.jsx(k,{w:"50%",disabled:!0,label:"Final Amount",...n.getInputProps("finalAmount")}),e.jsx(d,{data:[{label:"Myanmar Kyat",value:"1"}],w:"50%",label:"Final Currency",...n.getInputProps("finalCurrency")})]}),e.jsx(b,{...n.getInputProps("date"),label:"Date",leftSection:e.jsx(A,{}),leftSectionPointerEvents:"none",placeholder:"Enter date"}),e.jsx(Q,{...n.getInputProps("remark"),label:"Remark",placeholder:"Enter remark"}),e.jsxs(h,{justify:"end",gap:15,mt:20,children:[e.jsx(w,{variant:"outline",radius:4,size:"sm",onClick:o,color:u,children:"Cancel"}),e.jsx(w,{loading:m,disabled:m,type:"submit",radius:4,size:"sm",color:u,children:"Create"})]})]})})]})}),e.jsx(M,{onClick:r,children:"Expense"})]})},Y=async(s,r)=>await(await D.get(`/expenses?startDate=${s}&endDate=${r}`)).data.list,Z=(s,r)=>$({queryKey:["expense",s,r],queryFn:()=>Y(s,r),select:o=>o.map((t,c)=>({...t,no:c+1}))}),ee=()=>{const s=W(),r=F(),[o,t]=p.useState("all"),[c,x]=p.useState(null),[m,l]=p.useState(null),{data:n,isLoading:g}=Z(C(c)||"",C(m)||""),a=()=>{x(null),l(null)};return e.jsxs(E,{p:"sm",children:[e.jsxs(j,{align:"center",justify:"space-between",children:[e.jsxs(j,{align:"center",gap:15,children:[e.jsx(P,{style:{cursor:"pointer"},onClick:()=>r(-1)}),e.jsx(q,{children:"Expense List"})]}),e.jsx(X,{})]}),e.jsxs(j,{align:"center",gap:15,justify:"end",children:[e.jsx(R,{onClick:a}),e.jsx(b,{w:150,leftSection:e.jsx(A,{}),leftSectionPointerEvents:"none",placeholder:"Start date",value:c,onChange:x}),e.jsx(b,{w:150,leftSection:e.jsx(A,{}),leftSectionPointerEvents:"none",placeholder:"End date",value:m,onChange:l}),e.jsx(d,{allowDeselect:!1,w:150,value:o,onChange:f=>t(f),data:[{label:"All",value:"all"},{label:"Bank",value:"bank"},{label:"Cash",value:"cash"}]}),e.jsx(z,{}),e.jsx(w,{bg:u,children:"Export"})]}),e.jsx(v,{children:g?e.jsx(j,{justify:"center",mt:30,children:e.jsx(V,{color:u})}):e.jsx(v,{children:e.jsx(G,{columns:s,data:n||[]})})})]})},be=()=>e.jsx(ee,{});export{be as default};
